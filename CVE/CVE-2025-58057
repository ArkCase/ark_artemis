#!/bin/bash

set -euo pipefail
. /.functions

GROUP_ID="io.netty"
ARTIFACT_IDS=(
	netty-buffer
	netty-codec
	netty-codec-http
	netty-codec-mqtt
	netty-codec-socks
	netty-common
	netty-handler
	netty-handler-proxy
	netty-resolver
	netty-transport
	netty-transport-classes-epoll
	netty-transport-classes-kqueue
	netty-transport-native-epoll
	netty-transport-native-kqueue
	netty-transport-native-unix-common
)
VERSION="4.1.127.Final"

set_or_default BASE_DIR "/app"
set_or_default HOME_DIR "${BASE_DIR}/artemis"
set_or_default LIB_DIR "${HOME_DIR}/lib"

eyes "Applying remediation for CVE-2025-58057"
for ARTIFACT_ID in "${ARTIFACT_IDS[@]}" ; do
	find "${LIB_DIR}" -type f -name "${ARTIFACT_ID}-4.*" -delete -print
	mvn-get "${GROUP_ID}:${ARTIFACT_ID}:${VERSION}:jar" "${LIB_DIR}"
done
ok "Remediation complete"
