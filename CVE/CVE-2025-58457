#!/bin/bash

set -euo pipefail
. /.functions

GROUP_ID="org.apache.zookeeper"
ARTIFACT_IDS=(
	zookeeper
	zookeeper-jute
)
VERSION="3.9.4"

set_or_default BASE_DIR "/app"
set_or_default HOME_DIR "${BASE_DIR}/artemis"
set_or_default LIB_DIR "${HOME_DIR}/lib"

eyes "Applying remediation for CVE-2025-58457"
for ARTIFACT_ID in "${ARTIFACT_IDS[@]}" ; do
	find "${LIB_DIR}" -type f -name "${ARTIFACT_ID}-3.*" -delete -print
	mvn-get "${GROUP_ID}:${ARTIFACT_ID}:${VERSION}:jar" "${LIB_DIR}"
done
ok "Remediation complete"
